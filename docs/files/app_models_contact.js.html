<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/models/contact.js - mdeditor</title>
    <meta name="description" content="Small description for mdeditor goes here">
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/theme.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" type="image/png" href="../assets/img/favicon.png">
    
</head>
<body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a href="../" class="navbar-brand">
            <img src="../assets/img/mdeditor-logo.png" alt="">
            <span>API Docs</span>
          </a>
        </div>

        <div class="collapse navbar-collapse" id="nav">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/adiwg/mdEditor" class="fa fa-github github"></a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div id="main-wrapper" class="row">
        <div id="content-wrapper">
            <ol class="panel-group" id="sidebar" role="tablist" aria-multiselectable="true">
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-search-heading">
                        <h4 class="panel-title">
                      <a role="button" data-toggle="collapse" href="#sidebar-search" aria-expanded="true" aria-controls="collapseOne">
                        Search
                      </a>
                    </h4>
                    </div>
                    <div id="sidebar-search" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-search-heading">
                        <div class="panel-body">
                            <div id="api-tabview-filter">
                                <input type="search" id="api-filter" placeholder="Search...">
                            </div>
                        </div>
                    </div>
                </li>
                    <li class="panel panel-default">
                        <div class="panel-heading" role="tab" id="sidebar-version-heading">
                            <h4 class="panel-title">
                                <a role="button" href="https://github.com/adiwg/mdEditor/commits/55944267" target="_blank">
                                  Tag: 0.7.0.55944267
                                </a>
                            </h4>
                        </div>
                    </li>
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-modules-heading">
                        <h4 class="panel-title">
                    <a role="button" data-toggle="collapse" href="#sidebar-modules" aria-expanded="true" aria-controls="collapseOne">
                      Modules
                    </a>
                  </h4>
                    </div>
                    <div id="sidebar-modules" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-modules-heading">
                        <div class="panel-body">
                                <ol>
                                        <li>
                                            <a href="../modules/ember-json-tree.html">ember-json-tree</a>
                                                    <li class="sub"><a href="../modules/tree-view.html">tree-view</a></li>
                                                    <li class="sub"><a href="../modules/tree-search.html">tree-search</a></li>
                                                    <li class="sub"><a href="../modules/helpers.html">helpers</a></li>
                                        </li>
                                        <li>
                                            <a href="../modules/mdeditor.html">mdeditor</a>
                                                    <li class="sub"><a href="../modules/mixins.html">mixins</a></li>
                                                    <li class="sub"><a href="../modules/data-models.html">data-models</a></li>
                                                    <li class="sub"><a href="../modules/components-control.html">components-control</a></li>
                                                    <li class="sub"><a href="../modules/components-input.html">components-input</a></li>
                                                    <li class="sub"><a href="../modules/components-layout.html">components-layout</a></li>
                                                    <li class="sub"><a href="../modules/components-object.html">components-object</a></li>
                                        </li>
                                </ol>
                        </div>
                    </div>
                </li>
            
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-classes-heading">
                        <h4 class="panel-title">
                      <a role="button" data-toggle="collapse" href="#sidebar-classes" aria-expanded="true" aria-controls="collapseOne">
                        Classes
                      </a>
                    </h4>
                    </div>
                    <div id="sidebar-classes" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-classes-heading">
                        <div class="panel-body">
                            <ol>
                                    <li>
                                        <a href="../classes/contact.html">contact</a>
                                    </li>
                                    <li>
                                        <a href="../classes/make-range.html">make-range</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-address.html">md-address</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-array-table.html">md-array-table</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-boolean.html">md-boolean</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-button-modal.html">md-button-modal</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-card.html">md-card</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-citation.html">md-citation</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-citation-array.html">md-citation-array</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-codelist.html">md-codelist</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-codelist-multi.html">md-codelist-multi</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-contact-link.html">md-contact-link</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-contact-title.html">md-contact-title</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-date-range.html">md-date-range</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-datetime.html">md-datetime</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-definition.html">md-definition</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-graphic-array.html">md-graphic-array</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-identifier-array.html">md-identifier-array</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-identifier-object-table.html">md-identifier-object-table</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-import-csv.html">md-import-csv</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-input.html">md-input</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-input-confirm.html">md-input-confirm</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-maintenance.html">md-maintenance</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-markdown-editor.html">md-markdown-editor</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-object-table.html">md-object-table</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-online-resource-array.html">md-online-resource-array</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-phone-array.html">md-phone-array</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-scroll-spy.html">md-scroll-spy</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-select.html">md-select</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-select-contacts.html">md-select-contacts</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-select-table.html">md-select-table</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-select-thesaurus.html">md-select-thesaurus</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-simple-array-table.html">md-simple-array-table</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-spotlight.html">md-spotlight</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-textarea.html">md-textarea</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-toggle.html">md-toggle</a>
                                    </li>
                                    <li>
                                        <a href="../classes/md-wrap.html">md-wrap</a>
                                    </li>
                                    <li>
                                        <a href="../classes/object-template.html">object-template</a>
                                    </li>
                                    <li>
                                        <a href="../classes/tree-branch.html">tree-branch</a>
                                    </li>
                                    <li>
                                        <a href="../classes/tree-label.html">tree-label</a>
                                    </li>
                                    <li>
                                        <a href="../classes/tree-leaf.html">tree-leaf</a>
                                    </li>
                                    <li>
                                        <a href="../classes/tree-search.html">tree-search</a>
                                    </li>
                                    <li>
                                        <a href="../classes/tree-view.html">tree-view</a>
                                    </li>
                            </ol>
                        </div>
                    </div>
                </li>
            </ol>
            <div class="content-container">
                <div class="apidocs">
                    <div id="docs-main">
                        <div class="content">
<div class="page-header">
    <h1><i class="fa fa-file-code-o" aria-hidden="true"></i>  File</h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
import {
  alias,
  notEmpty
} from &#x27;@ember/object/computed&#x27;;
import {
  isEmpty
} from &#x27;@ember/utils&#x27;;
import EmberObject, {
  get,
  computed
} from &#x27;@ember/object&#x27;;
import {
  Copyable
} from &#x27;ember-copy&#x27;
import DS from &#x27;ember-data&#x27;;
import uuidV4 from &#x27;uuid/v4&#x27;;
import Validator from &#x27;validator&#x27;;
import Model from &#x27;mdeditor/models/base&#x27;;
import {
  validator,
  buildValidations
} from &#x27;ember-cp-validations&#x27;;
import {
  inject as service
} from &#x27;@ember/service&#x27;;

const Validations = buildValidations({
  &#x27;json.contactId&#x27;: validator(&#x27;presence&#x27;, {
    presence: true,
    ignoreBlank: true
  }),
  &#x27;json.name&#x27;: [
    validator(&#x27;format&#x27;, {
      regex: /^\s+$/,
      inverse: true,
      isWarning: true,
      message: &quot;Name should not be only white-space.&quot;
    }),
    validator(&#x27;presence&#x27;, {
      disabled: notEmpty(&#x27;model.json.positionName&#x27;),
      presence: true
    })
  ],
  &#x27;json.positionName&#x27;: [
    validator(&#x27;format&#x27;, {
      regex: /^\s+$/,
      inverse: true,
      isWarning: true,
      message: &quot;Position Name should not be only white-space.&quot;
    }),
    validator(&#x27;presence&#x27;, {
      disabled: notEmpty(&#x27;model.json.name&#x27;),
      presence: true
    })
  ],
  &#x27;json.isOrganization&#x27;: validator(&#x27;presence&#x27;, {
    presence: true,
    ignoreBlank: true
  })
});

const JsonDefault = EmberObject.extend({
  init() {
    this._super(...arguments);
    this.setProperties({
      &#x27;contactId&#x27;: uuidV4(),
      &#x27;isOrganization&#x27;: false,
      &#x27;name&#x27;: null,
      //&#x27;positionName&#x27;: null,
      &#x27;memberOfOrganization&#x27;: [],
      &#x27;logoGraphic&#x27;: [],
      &#x27;phone&#x27;: [],
      &#x27;address&#x27;: [],
      &#x27;electronicMailAddress&#x27;: [],
      &#x27;onlineResource&#x27;: [],
      &#x27;hoursOfService&#x27;: []
      //&#x27;contactInstructions&#x27;: null,
      //&#x27;contactType&#x27;: null;
    });
  }
});

const Contact = Model.extend(Validations, Copyable, {
  /**
   * Contact model
   *
   * @class contact
   * @constructor
   * @extends DS.Model
   * @mixin Ember.Copyable
   * @module mdeditor
   * @submodule data-models
   */

  contactsService: service(&#x27;contacts&#x27;),
  contacts: DS.hasMany(&#x27;contact&#x27;, {
    inverse: &#x27;organizations&#x27;
  }),
  organizations: DS.hasMany(&#x27;contact&#x27;, {
    inverse: &#x27;contacts&#x27;
  }),

  /**
   * The json object for the contact. The data for the contact is stored in this
   * object.
   *
   * @attribute json
   * @type {json}
   * @required
   */
  json: DS.attr(&#x27;json&#x27;, {
    defaultValue: function () {
      return JsonDefault.create();
    }
  }),

  /**
   * The timestamp for the record
   *
   * @attribute dateUpdated
   * @type {date}
   * @default new Date()
   * @required
   */
  dateUpdated: DS.attr(&#x27;date&#x27;, {
    defaultValue() {
      return new Date();
    }
  }),

  name: alias(&#x27;json.name&#x27;),
  contactId: alias(&#x27;json.contactId&#x27;),

  /**
   * The formatted display string for the contact
   *
   * @property title
   * @type {String}
   * @readOnly
   * @category computed
   * @requires json.name, json.positionName
   */
  title: computed(&#x27;json.{name,positionName,isOrganization}&#x27;,
    function () {
      const json = this.json;

      return json.name || (json.isOrganization ? null : json.positionName);
    }),

  // /**
  //  * The formatted display string for the contact
  //  *
  //  * @property title
  //  * @type {String}
  //  * @readOnly
  //  * @category computed
  //  * @requires json.name, json.positionName
  //  */
  // updateMembers: Ember.observer(&#x27;json.memberOfOrganization.[]&#x27;,
  //   function () {
  //     //const me = this;
  //     const json = this.get(&#x27;json&#x27;);
  //     const value = json.memberOfOrganization;
  //
  //     let store = this.get(&#x27;store&#x27;);
  //     let contacts = store.peekAll(&#x27;contact&#x27;);
  //     let organizations = this.get(&#x27;organizations&#x27;)
  //       .clear();
  //
  //     value.forEach(function (id) {
  //       let rec = contacts.findBy(&#x27;json.contactId&#x27;, id);
  //
  //       if(rec) {
  //         organizations.pushObject(rec);
  //       }
  //       //rec.get(&#x27;contacts&#x27;).pushObject(me);
  //     });
  //
  //   }),

  /**
   * The type of contact
   *
   * @property type
   * @type {String}
   * @readOnly
   * @category computed
   * @requires json.isOrganization
   */
  type: computed(&#x27;json.isOrganization&#x27;,
    function () {
      return this.get(&#x27;json.isOrganization&#x27;) ? &#x27;Organization&#x27; :
        &#x27;Individual&#x27;;
    }),

  /**
   * The display icon for the contact
   *
   * @property icon
   * @type {String}
   * @readOnly
   * @category computed
   * @requires json.isOrganization
   */
  icon: computed(&#x27;json.isOrganization&#x27;,
    function () {
      const name = this.get(&#x27;json.isOrganization&#x27;);

      return name ? &#x27;users&#x27; : &#x27;user&#x27;;
    }),

  /**
   * The URI of the default logo for the contact.
   *
   * @property defaultLogo
   * @type {String}
   * @readOnly
   * @category computed
   * @requires json.logoGraphic.firstObject.fileUri.firstObject.uri
   */
  defaultLogo: computed(
    &#x27;json.logoGraphic.firstObject.fileUri.firstObject.uri&#x27;,
    &#x27;defaultOrganization&#x27;,
    function () {
      let uri = this.get(
        &#x27;json.logoGraphic.firstObject.fileUri.firstObject.uri&#x27;);

      if(uri) {
        return uri;
      }
      let orgId = get(this, &#x27;defaultOrganization&#x27;);

      if(orgId &amp;&amp; orgId !== this.get(&#x27;json.contactId&#x27;)) {
        let contacts = this.get(&#x27;contactsService.organizations&#x27;);
        let org = contacts.findBy(&#x27;json.contactId&#x27;, orgId);

        if(org) {
          return get(org, &#x27;defaultLogo&#x27;);
        }
      }

      return null;
    }),

  /**
   * The id of the default organization for the contact.
   *
   * @property defaultOrganization
   * @type {String}
   * @readOnly
   * @category computed
   * @requires json.memberOfOrganization.[]
   */
  defaultOrganization: computed(&#x27;json.memberOfOrganization.[]&#x27;,
    function () {
      const json = this.json;

      let {
        memberOfOrganization
      } = json;

      return !isEmpty(memberOfOrganization) ?
        get(memberOfOrganization, &#x27;0&#x27;) :
        null;
    }),

  defaultOrganizationName: computed(&#x27;defaultOrganization&#x27;,
    function () {
      let contacts = this.get(&#x27;contactsService.organizations&#x27;);

      let org = contacts.findBy(&#x27;json.contactId&#x27;, get(this,
        &#x27;defaultOrganization&#x27;));

      return org ? get(org, &#x27;name&#x27;) : null;
    }),

  /**
   * The formatted (name or position) and organization(if any) of the contact.
   *
   * @property combinedName
   * @type {String}
   * @readOnly
   * @category computed
   * @requires json.name, json.isOrganization
   */
  combinedName: computed(&#x27;name&#x27;,
    &#x27;json{isOrganization,positionName,memberOfOrganization[]}&#x27;,
    function () {
      const json = this.json;

      let {
        name,
        positionName,
        isOrganization,
        memberOfOrganization
      } = json;

      let orgId = !isEmpty(memberOfOrganization) ?
        get(memberOfOrganization, &#x27;0&#x27;) :
        null;
      let combinedName = name || positionName;
      let orgName;

      if(orgId) {
        let contacts = this.get(&#x27;contactsService.organizations&#x27;);
        let org = contacts.findBy(&#x27;json.contactId&#x27;, orgId);

        if(org) {
          orgName = get(org, &#x27;name&#x27;);
        }
      }

      if(orgName &amp;&amp; !isOrganization) {
        return orgName += &quot;: &quot; + combinedName;
      }

      return combinedName;
    }),

  /**
   * The trimmed varsion of the contactId.
   *
   * @property shortId
   * @type {String}
   * @readOnly
   * @category computed
   * @requires json.contactId
   */
  shortId: computed(&#x27;json.contactId&#x27;, function () {
    const contactId = this.get(&#x27;json.contactId&#x27;);
    if(contactId &amp;&amp; Validator.isUUID(contactId)) {
      let index = contactId.indexOf(&#x27;-&#x27;);

      return contactId.substring(0, index);
    }

    return contactId;
  }),

  status: computed(&#x27;hasDirtyHash&#x27;, function () {
    let dirty = this.hasDirtyHash;
    let errors = this.hasSchemaErrors;

    if(this.currentHash) {
      return dirty ? &#x27;danger&#x27; : errors ? &#x27;warning&#x27; : &#x27;success&#x27;;
    }

    return &#x27;success&#x27;;
  }),

  /**
   * A list of schema errors return by the validator.
   *
   * @property hasSchemaErrors
   * @type {Array}
   * @readOnly
   * @category computed
   * @requires status
   */
  hasSchemaErrors: computed(&#x27;status&#x27;, function () {
    let mdjson = this.mdjson;
    let errors = mdjson.validateContact(this)
      .errors;

    //console.log(errors);

    return errors;
  }),

  /**
   * Create a copy of the record in the store.
   *
   * @method copy
   * @chainable
   * @return {DS.Model}
   */
  copy() {
    let current = this.cleanJson;
    let json = EmberObject.create(current);
    let {
      name,
      positionName,
      isOrganization
    } = current;

    json.setProperties({
      isOrganization: isOrganization,
      name: name ? &#x60;Copy of ${name}&#x60; : null,
      positionName: name ? positionName : &#x60;Copy of ${positionName}&#x60;,
      contactId: uuidV4()
    });

    return this.store.createRecord(&#x27;contact&#x27;, {
      json: json
    });
  }
});

export {
  Contact as
  default,
  JsonDefault
};

    </pre>
</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../assets/vendor/prettify/prettify-min.js"></script>
    <script>prettyPrint();</script>
    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="../assets/vendor/jquery-ui/jquery-ui.min.js"></script>
    <script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
    <script src="../assets/vendor/github-slugger/slugger.js"></script>
    <script src="../assets/js/yuidoc-bootstrap.js"></script>
</body>
</html>
